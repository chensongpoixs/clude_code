<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="800" height="450" viewBox="0 0 800 450" xmlns="http://www.w3.org/2000/svg">
  <desc>带动画的 Code Agent PEV 流程图</desc>
  <style>
    @keyframes fadeInOut {
      0%, 100% { opacity: 0.3; stroke-width: 1; }
      50% { opacity: 1; stroke-width: 3; }
    }
    @keyframes moveDash {
      to { stroke-dashoffset: -20; }
    }
    @keyframes activeNode {
      0%, 15% { fill: #fff; stroke-width: 2; }
      20%, 35% { fill: #e3f2fd; stroke-width: 4; }
      40%, 100% { fill: #fff; stroke-width: 2; }
    }
    
    .flow-line { stroke: #333; stroke-width: 2; fill: none; stroke-dasharray: 5; }
    .active-line { animation: moveDash 1s linear infinite; }
    .node-rect { fill: #fff; stroke: #333; stroke-width: 2; }
    .node-text { font-family: "PingFang SC", "Microsoft YaHei", sans-serif; font-size: 14px; font-weight: bold; }
    
    /* 节点动画序列 */
    #node-user { animation: activeNode 10s infinite 0s; }
    #node-planner { animation: activeNode 10s infinite 1.5s; }
    #node-executor { animation: activeNode 10s infinite 3s; }
    #node-tools { animation: activeNode 10s infinite 4.5s; }
    #node-verifier { animation: activeNode 10s infinite 6s; }
    #node-correction { animation: activeNode 10s infinite 7.5s; }
  </style>

  <rect width="800" height="450" fill="#ffffff"/>
  
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#333" />
    </marker>
  </defs>

  <!-- 1. 用户输入 -->
  <g transform="translate(50, 180)">
    <rect id="node-user" class="node-rect" width="100" height="60" rx="5"/>
    <text x="50" y="35" class="node-text" text-anchor="middle">用户输入</text>
  </g>

  <!-- 2. 规划器 -->
  <g transform="translate(200, 180)">
    <rect id="node-planner" class="node-rect" width="100" height="60" rx="5"/>
    <text x="50" y="35" class="node-text" text-anchor="middle">规划器</text>
    <text x="50" y="52" font-size="10" text-anchor="middle" fill="#666">Planner</text>
  </g>

  <!-- 3. 执行器 -->
  <g transform="translate(350, 180)">
    <rect id="node-executor" class="node-rect" width="100" height="60" rx="5"/>
    <text x="50" y="35" class="node-text" text-anchor="middle">执行器</text>
    <text x="50" y="52" font-size="10" text-anchor="middle" fill="#666">Executor</text>
  </g>

  <!-- 4. 工具层 (下方) -->
  <g transform="translate(350, 300)">
    <rect id="node-tools" class="node-rect" width="100" height="60" rx="5"/>
    <text x="50" y="35" class="node-text" text-anchor="middle">工具调用</text>
    <text x="50" y="52" font-size="10" text-anchor="middle" fill="#666">Tools</text>
  </g>

  <!-- 5. 验证器 -->
  <g transform="translate(500, 180)">
    <rect id="node-verifier" class="node-rect" width="100" height="60" rx="5"/>
    <text x="50" y="35" class="node-text" text-anchor="middle">验证器</text>
    <text x="50" y="52" font-size="10" text-anchor="middle" fill="#666">Verifier</text>
  </g>

  <!-- 6. 自修复循环 (上方) -->
  <g transform="translate(350, 60)">
    <rect id="node-correction" class="node-rect" width="100" height="60" rx="5" stroke-dasharray="3" stroke="#e53935"/>
    <text x="50" y="35" class="node-text" text-anchor="middle" fill="#e53935">自动修复</text>
    <text x="50" y="52" font-size="10" text-anchor="middle" fill="#e53935">Self-Correction</text>
  </g>

  <!-- 连接线 -->
  <!-- 用户 -> 规划 -->
  <path class="flow-line active-line" d="M150 210 H200" marker-end="url(#arrow)"/>
  <!-- 规划 -> 执行 -->
  <path class="flow-line active-line" d="M300 210 H350" marker-end="url(#arrow)"/>
  <!-- 执行 <-> 工具 -->
  <path class="flow-line active-line" d="M400 240 V300" marker-end="url(#arrow)"/>
  <path class="flow-line active-line" d="M400 300 V240" marker-end="url(#arrow)"/>
  <!-- 执行 -> 验证 -->
  <path class="flow-line active-line" d="M450 210 H500" marker-end="url(#arrow)"/>
  
  <!-- 验证 -> 成功输出 -->
  <path class="flow-line active-line" d="M600 210 H680" marker-end="url(#arrow)"/>
  <text x="730" y="215" class="node-text" text-anchor="middle" fill="#43a047">任务完成</text>

  <!-- 验证 -> 修复 (向上) -->
  <path class="flow-line active-line" d="M550 180 V90 H450" marker-end="url(#arrow)"/>
  <!-- 修复 -> 重新规划/执行 (向左下) -->
  <path class="flow-line active-line" d="M350 90 H250 V180" marker-end="url(#arrow)"/>

  <!-- 底部标题 -->
  <text x="400" y="400" class="node-text" text-anchor="middle" font-size="18">Code Agent 运行流程 (Plan-Execute-Verify)</text>
  <text x="400" y="425" font-family="sans-serif" font-size="12" text-anchor="middle" fill="#888">动态演示：从需求规划到执行自检的完整闭环</text>
</svg>

