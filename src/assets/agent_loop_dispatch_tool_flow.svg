<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 900">
  <style>
    .box { fill: #e8f4f8; stroke: #2c5aa0; stroke-width: 2; }
    .diamond { fill: #fff4e6; stroke: #d97706; stroke-width: 2; }
    .start { fill: #d1fae5; stroke: #059669; stroke-width: 2; }
    .end { fill: #fee2e2; stroke: #dc2626; stroke-width: 2; }
    .text { font-family: 'Microsoft YaHei', Arial, sans-serif; font-size: 12px; }
    .title { font-size: 16px; font-weight: bold; }
    @keyframes flow {
      0% { stroke-dashoffset: 0; }
      100% { stroke-dashoffset: 20; }
    }
    .arrow { stroke: #1f2937; stroke-width: 2; fill: none; marker-end: url(#arrowhead); animation: flow 1s linear infinite; }
  </style>
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#1f2937" />
    </marker>
  </defs>
  
  <text x="400" y="30" text-anchor="middle" class="text title">_dispatch_tool 工具分发流程图</text>
  
  <rect x="300" y="60" width="200" height="40" rx="5" class="start"/>
  <text x="400" y="85" text-anchor="middle" class="text">开始：接收 name, args</text>
  
  <polygon points="400,120 500,150 400,180 300,150" class="diamond"/>
  <text x="400" y="155" text-anchor="middle" class="text">工具名称匹配</text>
  
  <!-- 工具分支 -->
  <rect x="50" y="200" width="150" height="30" rx="5" class="box"/>
  <text x="125" y="220" text-anchor="middle" class="text">list_dir</text>
  
  <rect x="50" y="240" width="150" height="30" rx="5" class="box"/>
  <text x="125" y="260" text-anchor="middle" class="text">read_file</text>
  
  <rect x="50" y="280" width="150" height="30" rx="5" class="box"/>
  <text x="125" y="300" text-anchor="middle" class="text">glob_file_search</text>
  
  <rect x="50" y="320" width="150" height="30" rx="5" class="box"/>
  <text x="125" y="340" text-anchor="middle" class="text">grep</text>
  
  <rect x="50" y="360" width="150" height="30" rx="5" class="box"/>
  <text x="125" y="380" text-anchor="middle" class="text">apply_patch</text>
  
  <rect x="50" y="400" width="150" height="30" rx="5" class="box"/>
  <text x="125" y="420" text-anchor="middle" class="text">undo_patch</text>
  
  <rect x="50" y="440" width="150" height="30" rx="5" class="box"/>
  <text x="125" y="460" text-anchor="middle" class="text">write_file</text>
  
  <rect x="50" y="480" width="150" height="30" rx="5" class="box"/>
  <text x="125" y="500" text-anchor="middle" class="text">run_cmd</text>
  
  <rect x="50" y="520" width="150" height="30" rx="5" class="box"/>
  <text x="125" y="540" text-anchor="middle" class="text">search_semantic</text>
  
  <!-- 执行工具 -->
  <rect x="300" y="360" width="200" height="40" rx="5" class="box"/>
  <text x="400" y="385" text-anchor="middle" class="text">调用对应工具方法</text>
  
  <polygon points="400,420 450,440 400,460 350,440" class="diamond"/>
  <text x="400" y="445" text-anchor="middle" class="text">执行成功?</text>
  
  <rect x="300" y="480" width="200" height="40" rx="5" class="end"/>
  <text x="400" y="505" text-anchor="middle" class="text">返回 ToolResult</text>
  
  <!-- 异常处理 -->
  <rect x="550" y="420" width="200" height="40" rx="5" class="box"/>
  <text x="650" y="445" text-anchor="middle" class="text">捕获异常</text>
  
  <rect x="550" y="480" width="200" height="40" rx="5" class="end"/>
  <text x="650" y="505" text-anchor="middle" class="text">返回错误 ToolResult</text>
  
  <!-- 未知工具 -->
  <rect x="300" y="540" width="200" height="40" rx="5" class="end"/>
  <text x="400" y="565" text-anchor="middle" class="text">返回 E_NO_TOOL</text>
  
  <!-- 箭头 -->
  <path d="M 400,100 L 400,120" class="arrow"/>
  <path d="M 300,150 L 125,150 L 125,200" class="arrow"/>
  <path d="M 400,150 L 400,360" class="arrow"/>
  <path d="M 125,230 L 125,240" class="arrow"/>
  <path d="M 125,270 L 125,280" class="arrow"/>
  <path d="M 125,310 L 125,320" class="arrow"/>
  <path d="M 125,350 L 125,360" class="arrow"/>
  <path d="M 125,390 L 125,400" class="arrow"/>
  <path d="M 125,430 L 125,440" class="arrow"/>
  <path d="M 125,470 L 125,480" class="arrow"/>
  <path d="M 125,510 L 125,520" class="arrow"/>
  <path d="M 200,370 L 300,370 L 300,360" class="arrow"/>
  <path d="M 400,400 L 400,420" class="arrow"/>
  <path d="M 350,440 L 300,440 L 300,480" class="arrow"/>
  <path d="M 450,440 L 550,440 L 550,420" class="arrow"/>
  <path d="M 650,460 L 650,480" class="arrow"/>
  <path d="M 500,150 L 400,150 L 400,540" class="arrow"/>
</svg>

