<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="800" height="500" viewBox="0 0 800 500" xmlns="http://www.w3.org/2000/svg">
  <desc>Code Agent 系统架构动画图</desc>
  <style>
    @keyframes pulse {
      0%, 100% { opacity: 1; filter: drop-shadow(0 0 2px rgba(0,0,0,0.1)); }
      50% { opacity: 0.8; filter: drop-shadow(0 0 8px rgba(33,150,243,0.4)); }
    }
    @keyframes flow {
      to { stroke-dashoffset: -20; }
    }
    .component { fill: #ffffff; stroke: #333333; stroke-width: 2; transition: all 0.3s; }
    .label { font-family: "PingFang SC", "Microsoft YaHei", sans-serif; font-size: 13px; font-weight: bold; fill: #333; }
    .sub-label { font-family: sans-serif; font-size: 10px; fill: #666; }
    .connector { stroke: #666; stroke-width: 1.5; fill: none; stroke-dasharray: 5; animation: flow 1s linear infinite; }
    
    /* 核心层级区分 */
    .layer-box { fill: #f8f9fa; stroke: #dee2e6; stroke-dasharray: 4; }
    .layer-label { font-family: sans-serif; font-size: 12px; font-weight: bold; fill: #adb5bd; }
    
    /* 交互动画 */
    #comp-llm { animation: pulse 2s infinite; }
    #comp-orchestrator { stroke: #2196f3; stroke-width: 3; }
  </style>

  <rect width="800" height="500" fill="#ffffff"/>

  <!-- 背景层级框 -->
  <g id="layers">
    <rect x="30" y="40" width="740" height="100" rx="10" class="layer-box"/>
    <text x="40" y="60" class="layer-label">交互层 INTERFACE</text>
    
    <rect x="30" y="160" width="740" height="180" rx="10" class="layer-box"/>
    <text x="40" y="180" class="layer-label">代理编排层 AGENT CORE</text>
    
    <rect x="30" y="360" width="740" height="110" rx="10" class="layer-box"/>
    <text x="40" y="380" class="layer-label">执行层 TOOLING &amp; ENV</text>
  </g>

  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#666" />
    </marker>
  </defs>

  <!-- 交互层组件 -->
  <g transform="translate(100, 60)">
    <rect width="120" height="60" rx="5" class="component"/>
    <text x="60" y="30" class="label" text-anchor="middle">用户命令行</text>
    <text x="60" y="45" class="sub-label" text-anchor="middle">CLI / UI</text>
  </g>

  <!-- 编排层组件 -->
  <g transform="translate(100, 220)">
    <rect id="comp-orchestrator" width="140" height="80" rx="5" class="component" style="fill: #e3f2fd;"/>
    <text x="70" y="35" class="label" text-anchor="middle">代理编排中心</text>
    <text x="70" y="55" class="sub-label" text-anchor="middle">Orchestrator</text>
  </g>

  <g transform="translate(320, 180)">
    <rect width="120" height="50" rx="5" class="component"/>
    <text x="60" y="25" class="label" text-anchor="middle">规划器</text>
    <text x="60" y="40" class="sub-label" text-anchor="middle">Planner</text>
  </g>

  <g transform="translate(320, 260)">
    <rect width="120" height="50" rx="5" class="component"/>
    <text x="60" y="25" class="label" text-anchor="middle">上下文引擎</text>
    <text x="60" y="40" class="sub-label" text-anchor="middle">Context Engine</text>
  </g>

  <g transform="translate(550, 210)">
    <rect id="comp-llm" width="150" height="100" rx="10" class="component" style="fill: #fff9c4; stroke: #fbc02d;"/>
    <text x="75" y="45" class="label" text-anchor="middle">大语言模型</text>
    <text x="75" y="65" class="sub-label" text-anchor="middle">LLM (llama.cpp)</text>
  </g>

  <!-- 执行层组件 -->
  <g transform="translate(80, 390)">
    <rect width="100" height="50" rx="5" class="component"/>
    <text x="50" y="30" class="label" text-anchor="middle">文件系统</text>
  </g>
  <g transform="translate(220, 390)">
    <rect width="100" height="50" rx="5" class="component"/>
    <text x="50" y="30" class="label" text-anchor="middle">终端 Shell</text>
  </g>
  <g transform="translate(360, 390)">
    <rect width="100" height="50" rx="5" class="component"/>
    <text x="50" y="30" class="label" text-anchor="middle">Git 工作流</text>
  </g>
  <g transform="translate(500, 390)">
    <rect width="100" height="50" rx="5" class="component" style="stroke: #43a047;"/>
    <text x="50" y="30" class="label" text-anchor="middle" fill="#2e7d32">测试/验证</text>
  </g>

  <!-- 连线 -->
  <path class="connector" d="M160 120 V220" marker-end="url(#arrow)"/>
  <path class="connector" d="M240 240 H320" marker-end="url(#arrow)"/>
  <path class="connector" d="M240 280 H320" marker-end="url(#arrow)"/>
  <path class="connector" d="M440 220 H550" marker-end="url(#arrow)"/>
  <path class="connector" d="M440 280 H550" marker-end="url(#arrow)"/>
  
  <path class="connector" d="M130 300 V390" marker-end="url(#arrow)"/>
  <path class="connector" d="M170 300 V390" marker-end="url(#arrow)"/>
  <path class="connector" d="M210 300 V390" marker-end="url(#arrow)"/>
  <path class="connector" d="M550 390 L240 280" marker-end="url(#arrow)"/> <!-- 验证反馈 -->

  <!-- 底部标题 -->
  <text x="400" y="490" class="label" text-anchor="middle" font-size="16">Code Agent 分层系统架构图</text>
</svg>

