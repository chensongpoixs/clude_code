# clude-code æ¨¡å—è¿›åº¦ã€æŠ€æœ¯åˆ†æä¸è§„åˆ’æŠ¥å‘Š (src/)

æœ¬æ–‡ä»¶æ±‡æ€»äº† **clude-code** çš„å½“å‰è¿›åº¦ã€æŠ€æœ¯æ¶æ„åˆ†æä»¥åŠä¸ä¸šç•Œ Code Agent çš„å¯¹æ¯”ç»“è®ºã€‚

---

## 1. æ¨¡å—å®ç°è¿›åº¦åˆ†æ (Progress Analysis)

å½“å‰ç‰ˆæœ¬å®šä½äº **MVP+ (V0.1.0)**ï¼Œå·²å®ç°æœ¬åœ°æ¨¡å‹é©±åŠ¨çš„é—­ç¯å¼€å‘èƒ½åŠ›ï¼Œå¹¶æ­£åœ¨å‘â€œä¸šç•Œçº§äº§å“ä½“éªŒâ€æ¼”è¿›ã€‚

### 1.1 è½åœ°å®Œæˆåº¦ (Scorecard)

| ç»´åº¦ | å®ç°æ¨¡å— | è½åœ°ç¨‹åº¦ | ä¸šç•Œå¯¹æ¯”æ°´å¹³ | æ ¸å¿ƒäº®ç‚¹ |
| :--- | :--- | :--- | :--- | :--- |
| **åŸºç¡€äº¤äº’** | `cli/` | 95% | **é«˜** | æ”¯æŒ Claude Code é£æ ¼ CLI (Enhanced UI) å’Œ OpenCode é£æ ¼ TUI (å¤šçª—æ ¼æ»šåŠ¨)ï¼›Slash Commands (`/help`, `/config`) å®Œå¤‡ã€‚ |
| **æ ¸å¿ƒç¼–æ’** | `orchestrator/` | 90% | **é«˜** | æ˜¾å¼ Plan â†’ ä¾èµ–è°ƒåº¦ â†’ æŒ‰æ­¥æ‰§è¡Œ â†’ å¤±è´¥é‡è§„åˆ’ â†’ æœ€ç»ˆéªŒè¯ï¼›æ”¯æŒæ­»é”æ£€æµ‹ä¸å±€éƒ¨é‡è§„åˆ’ï¼ˆP0-3 å»ºè®¾ä¸­ï¼‰ã€‚ |
| **å·¥å…·ç®±** | `tooling/` | 92% | **é«˜** | ç»Ÿä¸€ ToolSpec å¥‘çº¦ï¼›`apply_patch` æ”¯æŒæ¨¡ç³ŠåŒ¹é…ä¸ Undo è¯æ®é“¾ï¼›`display` å·¥å…·æ”¯æŒæ€ç»´é“¾å¯è§†åŒ–ã€‚ |
| **çŸ¥è¯†/RAG** | `knowledge/` | 85% | **ä¸­é«˜** | AST-aware (Tree-sitter) åˆ†å— + å…ƒæ•°æ®èåˆï¼›æŸ¥è¯¢ä¾§ Hybrid Rerankï¼›LanceDB å¼‚æ­¥ç´¢å¼•ã€‚ |
| **éªŒè¯é—­ç¯** | `verification/` | 100% | **é«˜** | é›¶é…ç½®æ¢æµ‹ + å‘½ä»¤ç™½åå• + ç¯å¢ƒéš”ç¦» + å¤šè¯­è¨€è§£æå™¨ï¼ˆPython/Node.js/Go/Rustï¼‰ã€‚ |
| **æ¨¡å‹æ¥å…¥** | `llm/` | 85% | **é«˜** | æ·±åº¦é€‚é… llama.cppï¼›æ”¯æŒ Context æ™ºèƒ½è£å‰ªä¸ Token ä¼°ç®—ï¼›`api_mode=openai_compat` å…¼å®¹æ€§å¼ºã€‚ |
| **æ’ä»¶ç³»ç»Ÿ** | `plugins/` | 88% | **é«˜** | å£°æ˜å¼æ’ä»¶ (YAML/JSON) + å­è¿›ç¨‹æ²™ç®±ï¼›UI æ’ä»¶åŒ–æ¶æ„ã€‚ |
| **å®‰å…¨ç­–ç•¥** | `policy/` | 90% | **é«˜** | RBAC æƒé™æ¨¡å‹ + å·¥å…·çº§ Allow/Deny + è¿œç¨‹ç­–ç•¥ä¸‹å‘ + å®Œæ•´å®¡è®¡æ—¥å¿— (Audit Log)ã€‚ |
| **å¯è§‚æµ‹æ€§** | `observability/` | 80% | **ä¸­** | Trace/Audit å…¨é“¾è·¯è½ç›˜ï¼›æ”¯æŒ Session Usage ç»Ÿè®¡ï¼›ç¼ºå¯è§†åŒ–å›æ”¾å·¥å…· (P2)ã€‚ |

---

## 2. æŠ€æœ¯ä¸ä¸šç•Œæ¯”è¾ƒåˆ†æ (Industry Comparison)

æˆ‘ä»¬æ·±åº¦å¯¹æ ‡äº† **Claude Code**ã€**Aider** å’Œ **Cursor**ï¼Œå½¢æˆäº†ä»¥ä¸‹å·®å¼‚åŒ–ç»“è®ºã€‚

### 2.1 æ ¸å¿ƒä¼˜åŠ¿ (Pros)
1.  **å½»åº•çš„æœ¬åœ°éšç§ä¿æŠ¤**: åŸºäº `llama.cpp` åŸç”Ÿ HTTP å®¢æˆ·ç«¯ï¼Œæ•°æ®ä¸å‡ºåŸŸï¼Œé€‚åˆä¼ä¸šå†…ç½‘ç¯å¢ƒã€‚
2.  **ä¸¥æ ¼çš„å·¥ç¨‹å¥‘çº¦**: 
    - **ToolSpec**: å•ä¸€çœŸå®æºï¼Œæœç»æ–‡æ¡£ä¸ä»£ç æ¼‚ç§»ã€‚
    - **Pydantic Validation**: è¿è¡Œæ—¶å¼ºæ ¡éªŒï¼Œå¼¥è¡¥å°æ¨¡å‹æŒ‡ä»¤éµå¾ªèƒ½åŠ›å¼±çš„é—®é¢˜ã€‚
3.  **å¯è§‚æµ‹æ€§ä¼˜å…ˆ**: æ¯ä¸€è½®å¯¹è¯éƒ½æœ‰ `trace_id`ï¼ˆå»ºè®¾ä¸­ï¼‰ï¼Œæ¯ä¸€ä¸ªå·¥å…·è°ƒç”¨éƒ½æœ‰ `audit log`ï¼Œæ¯ä¸€å¤„ä»£ç ä¿®æ”¹éƒ½æœ‰ `undo hash`ã€‚
4.  **UI/UX çµæ´»æ€§**: åŒæ—¶æ”¯æŒâ€œæµå¼å¯¹è¯æµ (Classic/Enhanced)â€å’Œâ€œäº¤äº’å¼ TUI (OpenCode)â€ï¼Œæ»¡è¶³ä¸åŒç”¨æˆ·åå¥½ã€‚

### 2.2 å¾…è¡¥é½å·®è· (Cons & Gaps)
1.  **é•¿çª—å£ä¸Šä¸‹æ–‡ç®¡ç†**: ç›¸æ¯” Claude 200k/Gemini 1M çš„è¶…é•¿çª—å£ï¼Œæœ¬åœ°æ¨¡å‹ Context æœ‰é™ã€‚
    - *å¯¹ç­–*: å¼•å…¥ `WorkingMemory` (P2) å’Œæ›´æ¿€è¿›çš„ Context è£å‰ª/æ‘˜è¦ç­–ç•¥ã€‚
2.  **Git å·¥ä½œæµé›†æˆ**: ç¼ºå°‘åƒ Aider é‚£æ ·çš„â€œGit ä¸€ç­‰å…¬æ°‘â€ä½“éªŒï¼ˆè‡ªåŠ¨ commit message, PR reviewï¼‰ã€‚
    - *å¯¹ç­–*: è§„åˆ’ Git Workflow ä¸“ç”¨æ¨¡å— (Docs/09)ã€‚
3.  **é‡è§„åˆ’æˆæœ¬**: å…¨é‡é‡å†™ Plan æˆæœ¬é«˜ã€‚
    - *å¯¹ç­–*: å®æ–½å±€éƒ¨é‡è§„åˆ’ (Plan Patching) ç­–ç•¥ (P0-3)ã€‚

### 2.3 è¯¦ç»†åˆ†ææ–‡æ¡£
- [Agent å†³ç­–é“¾è·¯å®¡è®¡ä¸è¯„åˆ†](./docs/17-agent-decision-audit.md) (â˜…â˜…â˜…â˜…â˜… æ¨èé˜…è¯»)
- [ä¸šç•Œ Code Agent æŠ€æœ¯ç™½çš®ä¹¦](INDUSTRY_CODE_AGENT_TECH_WHITEPAPER.md)
- [RAG æ·±åº¦è°ƒä¼˜è·¯çº¿å›¾](RAG_INDEXING_DEEP_TUNING.md)

---

## 3. æ ¸å¿ƒåŠŸèƒ½å®ç°ç»†èŠ‚ (Implementation Details)

### 3.1 æ™ºèƒ½ç¼–æ’ (Orchestrator)
- **åŸç†**: åŒå±‚å¾ªç¯æ¶æ„ã€‚å¤–å±‚ `run_turn` è´Ÿè´£æ„å›¾è¯†åˆ«ä¸è§„åˆ’ç”Ÿæˆï¼›å†…å±‚ `execution` è´Ÿè´£ Step çº§è°ƒåº¦ä¸ ReAct é™çº§ã€‚
- **äº®ç‚¹**: 
    - **State Machine**: æ¸…æ™°çš„ INTAKE -> PLANNING -> EXECUTING -> VERIFYING çŠ¶æ€æµè½¬ã€‚
    - **Deadlock Detection**: è‡ªåŠ¨æ£€æµ‹æ­¥éª¤ä¾èµ–æ­»é”å¹¶ä¸­æ–­ã€‚

### 3.2 çŸ¥è¯†å¢å¼º (RAG)
- **åŸç†**: `IndexerService` åå°ç›‘å¬æ–‡ä»¶å˜æ›´ -> `TreeSitterChunker` æå– AST è¯­ä¹‰å— (Symbol/Scope) -> `CodeEmbedder` å‘é‡åŒ– -> `LanceDB` å­˜å‚¨ã€‚
- **äº®ç‚¹**:
    - **Hybrid Search**: å‘é‡ç›¸ä¼¼åº¦ + è¯æ³•åŒ¹é… + å…ƒæ•°æ® Rerank (Symbol Boost)ã€‚
    - **AST Metadata**: Chunk æºå¸¦ `symbol`, `node_type`, `scope`ï¼Œå¤§å¹…æå‡å¬å›å¯è§£é‡Šæ€§ã€‚

### 3.3 äº¤äº’ä½“éªŒ (CLI/UI)
- **OpenCode TUI**: åŸºäº `Textual` æ¡†æ¶ã€‚
    - **å¤šçª—æ ¼**: å·¦ä¾§ Chatï¼Œå³ä¾§ çŠ¶æ€/æ“ä½œ/äº‹ä»¶ï¼Œåº•éƒ¨ Inputã€‚
    - **å¼‚æ­¥åˆ·æ–°**: ä¸»çº¿ç¨‹ UI + åå° AgentLoopï¼Œé€šè¿‡ `Queue` ä¼ é€’äº‹ä»¶ï¼Œç•Œé¢ä¸å¡é¡¿ã€‚
    - **äº¤äº’**: æ”¯æŒé¼ æ ‡æ»šè½®ã€å†å²å›æº¯ã€å‘½ä»¤è¡¥å…¨ã€‚

---

## 4. æ¨¡å—å¯¼èˆª (Module Navigation)

ä¸ºäº†æ–¹ä¾¿å¼€å‘è€…æ·±å…¥ç†è§£å„å­ç³»ç»Ÿçš„å®ç°ï¼Œæˆ‘ä»¬åœ¨ `src/clude_code` çš„æ¯ä¸ªå­ç›®å½•ä¸‹éƒ½ç”Ÿæˆäº†ä¸“å±çš„ `README.md`ï¼š

- [ğŸš€ CLI äº¤äº’](./clude_code/cli/README.md)
- [ğŸ§  çŸ¥è¯†/RAG](./clude_code/knowledge/README.md)
- [ğŸ“¡ LLM é€‚é…](./clude_code/llm/README.md)
- [ğŸ‘ï¸ å¯è§‚æµ‹æ€§](./clude_code/observability/README.md)
- [âš™ï¸ æ ¸å¿ƒç¼–æ’](./clude_code/orchestrator/README.md)
- [ğŸ›¡ï¸ å®‰å…¨ç­–ç•¥](./clude_code/policy/README.md)
- [ğŸ› ï¸ å·¥å…·ç®±](./clude_code/tooling/README.md)
- [âœ… éªŒè¯é—­ç¯](./clude_code/verification/ANALYSIS_REPORT.md)
- [ğŸ”Œ æ’ä»¶ç³»ç»Ÿ](./clude_code/plugins/README.md)

---

## 5. å¿«é€Ÿå¼€å§‹ (Quick Start)

### å¸¸ç”¨å‘½ä»¤
```bash
# 1. åˆå§‹åŒ–é¡¹ç›®è®°å¿†
clude chat --model "..." --select-model
/init

# 2. äº¤äº’å¼å¯¹è¯ (OpenCode TUI)
clude chat --live --live-ui opencode

# 3. è¯Šæ–­ç¯å¢ƒ
clude doctor --fix

# 4. æŸ¥çœ‹å·¥å…·
clude tools --json
```

---
