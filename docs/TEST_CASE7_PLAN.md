# 测试案例 7：系统性扩展测试计划

## 一、测试目标

基于前6个测试案例的框架，对全部功能点进行系统性的扩展测试，确保测试覆盖无死角，避免因场景局限性导致的潜在缺陷。

## 二、功能点清单

### 2.1 文件操作工具

| 工具名 | 功能 | 测试用例 |
|--------|------|----------|
| `list_dir` | 列出目录内容 | ✅ 已测试（案例2） |
| `read_file` | 读取文件内容 | ✅ 已测试（案例5） |
| `read_symbol` | 按函数/类读取代码 | ⏳ 待测试 |
| `glob_file_search` | 按文件名模式查找文件 | ⏳ 待测试 |
| `grep` | 代码搜索 | ⏳ 待测试 |
| `write_file` | 写入文件 | ⏳ 待测试 |
| `apply_patch` | 补丁式编辑 | ⏳ 待测试 |
| `undo_patch` | 回滚补丁 | ⏳ 待测试 |

### 2.2 搜索与检索工具

| 工具名 | 功能 | 测试用例 |
|--------|------|----------|
| `search_semantic` | 语义检索（向量 RAG） | ⏳ 待测试 |
| `codesearch` | 网络代码搜索 | ⏳ 待测试 |

### 2.3 网络工具

| 工具名 | 功能 | 测试用例 |
|--------|------|----------|
| `websearch` | 网页搜索 | ⏳ 待测试 |
| `webfetch` | 抓取网页内容 | ⏳ 待测试 |
| `get_weather` | 获取实时天气 | ✅ 已测试（案例4） |
| `get_weather_forecast` | 获取天气预报 | ⏳ 待测试 |

### 2.4 代码分析工具

| 工具名 | 功能 | 测试用例 |
|--------|------|----------|
| `internal_repo_map` | 生成代码仓库结构图 | ⏳ 待测试 |
| `analyze_image` | 分析图片内容 | ⏳ 待测试 |

### 2.5 交互工具

| 工具名 | 功能 | 测试用例 |
|--------|------|----------|
| `display` | 向用户输出信息 | ✅ 已测试（案例3,4,6） |
| `question` | 向用户提问 | ⏳ 待测试 |

### 2.6 任务管理工具

| 工具名 | 功能 | 测试用例 |
|--------|------|----------|
| `todowrite` | 创建/更新任务 | ⏳ 待测试 |
| `todoread` | 读取任务列表 | ⏳ 待测试 |

### 2.7 子代理工具

| 工具名 | 功能 | 测试用例 |
|--------|------|----------|
| `run_task` | 启动和管理子代理 | ⏳ 待测试 |
| `get_task_status` | 获取任务状态 | ⏳ 待测试 |

### 2.8 其他工具

| 工具名 | 功能 | 测试用例 |
|--------|------|----------|
| `preview_multi_edit` | 预览多文件批量编辑 | ⏳ 待测试 |
| `load_skill` | 加载和执行预定义技能 | ⏳ 待测试 |

## 三、测试执行计划

### 3.1 文件操作工具测试

#### 测试 7.1.1: read_symbol 工具
**输入**: `读取 src/clude_code/orchestrator/planner.py 文件中的 parse_plan_from_text 函数`
**预期**: 成功读取函数代码，跳过注释

#### 测试 7.1.2: glob_file_search 工具
**输入**: `查找项目中所有 .py 文件`
**预期**: 返回所有 Python 文件列表

#### 测试 7.1.3: grep 工具
**输入**: `搜索代码中包含 "ToolSpec" 的所有位置`
**预期**: 返回匹配的行和文件位置

#### 测试 7.1.4: write_file 工具
**输入**: `创建一个测试文件 test_output.txt，内容为 "Hello World"`
**预期**: 文件成功创建

#### 测试 7.1.5: apply_patch 工具
**输入**: `修改 test_output.txt，将 "Hello World" 改为 "Hello Clude"`
**预期**: 补丁成功应用

#### 测试 7.1.6: undo_patch 工具
**输入**: `回滚刚才的补丁修改`
**预期**: 文件恢复到修改前状态

### 3.2 搜索与检索工具测试

#### 测试 7.2.1: search_semantic 工具
**输入**: `语义搜索代码中关于"计划解析"的相关内容`
**预期**: 返回语义相关的代码片段

#### 测试 7.2.2: codesearch 工具
**输入**: `搜索网络上的 Python 代码示例：如何解析 JSON`
**预期**: 返回相关代码片段

### 3.3 网络工具测试

#### 测试 7.3.1: websearch 工具
**输入**: `搜索"Python 最佳实践"`
**预期**: 返回搜索结果列表

#### 测试 7.3.2: webfetch 工具
**输入**: `抓取 https://www.python.org 的内容`
**预期**: 返回网页内容并缓存

#### 测试 7.3.3: get_weather_forecast 工具
**输入**: `获取北京未来3天的天气预报`
**预期**: 返回天气预报数据

### 3.4 代码分析工具测试

#### 测试 7.4.1: internal_repo_map 工具
**输入**: `生成当前项目的代码仓库结构图`
**预期**: 返回仓库结构图

#### 测试 7.4.2: analyze_image 工具
**输入**: `分析图片内容（如果有图片文件）`
**预期**: 返回图片分析结果

### 3.5 交互工具测试

#### 测试 7.5.1: question 工具
**输入**: `向用户提问：是否继续执行测试？`
**预期**: 返回用户回答（在交互模式下）

### 3.6 任务管理工具测试

#### 测试 7.6.1: todowrite 工具
**输入**: `创建一个任务：完成测试案例7`
**预期**: 任务成功创建

#### 测试 7.6.2: todoread 工具
**输入**: `读取所有待完成的任务`
**预期**: 返回任务列表

### 3.7 子代理工具测试

#### 测试 7.7.1: run_task 工具
**输入**: `启动一个子代理任务：分析代码质量`
**预期**: 任务成功启动

#### 测试 7.7.2: get_task_status 工具
**输入**: `获取刚才启动的任务状态`
**预期**: 返回任务状态信息

### 3.8 其他工具测试

#### 测试 7.8.1: preview_multi_edit 工具
**输入**: `预览对多个文件的批量编辑`
**预期**: 返回预览结果

#### 测试 7.8.2: load_skill 工具
**输入**: `加载一个预定义技能`
**预期**: 技能成功加载

## 四、测试执行顺序

1. **文件操作工具** (7.1.1 - 7.1.6)
2. **搜索与检索工具** (7.2.1 - 7.2.2)
3. **网络工具** (7.3.1 - 7.3.3)
4. **代码分析工具** (7.4.1 - 7.4.2)
5. **交互工具** (7.5.1)
6. **任务管理工具** (7.6.1 - 7.6.2)
7. **子代理工具** (7.7.1 - 7.7.2)
8. **其他工具** (7.8.1 - 7.8.2)

## 五、验收标准

- ✅ 所有工具调用成功
- ✅ 返回结果符合预期格式
- ✅ 无致命错误或崩溃
- ✅ 日志记录完整
- ✅ 错误处理正确

## 六、测试报告

每个测试用例执行后，记录：
- 执行时间
- 成功/失败状态
- 错误信息（如有）
- 返回结果摘要
- 日志位置

